# bootstrap

Первым делом инициализируется **ide\IdeClassLoader**, специальный загрузчик классов самой IDE. Затем загружается класс **ide\Ide** - сердце DevelNext.

# Класс Ide

Данный класс служит мостом ко всем остальным модулям DN. Он наследуется от **php\gui\framework\Application** и напрямую связан с UI. При запуске инициализируется логгер и перехватчик исключений.

![ExceptionHandler](https://raw.githubusercontent.com/broelik/dn_inside/master/images/exception_handler.png)

Затем проверяются аргументы командной строки. Если первый аргумент начинается с *develnext://*, то проверка осуществляется при помощи протоколов зарегистрированных в файле *.dn/protocolHandlers*, в ином случае аргумент воспринимается как файл *.dnproject* или *.zip* архив.

Далее загружается  **ide\account\ServiceManager** - класс для работы с различными сервисами DN(управление аккаунтом, загрузка/выгрузка проектов и т.д).

Затем идёт загрузка всех компонентов(расширений, различных компонентов редактора, шаблонов для проекта и т.д). Порядок регистрации такой:

1. Расширения
2. Компоненты редактора
3. Форматы
4. Шаблоны проектов
5. Команды

## Расширения

Базовым классом для всех расширения является **ide\AbstractExtension**. Этот класс имеет следующие методы:

* ```onIdeStart(): void``` - вызывается при запуске DN

* ```onIdeShutdown(): void``` - вызывается при завершении работы DN
* ```onRegister(): void``` - вызывается при регистрации расширения
* ```getDependencies(): array``` - список зависимостей для расширения

Первым вызывается метод ```getDependencies()``` для того, чтобы зарегистрировать зависимости, перед регистрацией самого расширения. Затем следует вызов ```onRegister()``` а метод ```onIdeStart()``` вызывается после того как зарегистрированы все компоненты.

```getDependencies()``` должен возвращать список имён классов. Данные классы должны быть экземплярами **ide\bundle\AbstractBundle** или **ide\AbstractExtension**.

Зарегистрировать расширение можно при помощи:

```php
ide\Ide::get()->registerExtension(string|AbstractExtension $ext): void;
```

передав туда имя класса или экземпляр класса **ide\AbstractExtension**.

Список стандартных расширения можно найти в файле *.dn/extensions*.

Подробнее об этом позже...

## Компоненты редактора

Здесь нужно сделать оговорку. Речь идёт о различных полях для редактирования объектов в редакторе(строковые редакторы, числовые редакторы, редактор шрифтов и т.д.).

![Пример](https://raw.githubusercontent.com/broelik/dn_inside/master/images/property_values_editor.png)

Такие компоненты наследуются от класса **ide\editors\value\ElementPropertyEditor**, а зарегистрировать их можно при помощи:

```php
ide\editors\value\ElementPropertyEditor::register(ElementPropertyEditor $element): void;
```

передав туда экземпляр соответствующего класса.

Список стандартных компонентов редактора можно найти в файле *.dn/propertyValueEditors*.

Подробнее об этом позже...

## Форматы

Форматы служат для добавления новых редакторов и различных панелей управления. 

Все форматы наследуются от **ide\formatsAbstractFormat**. Данный класс содержит следующие методы:

* ```getIcon(): ?mixed``` - возвращает иконку формата
* ```getTitle(string $path): string``` - возвращает отображаемое имя для файла, который относится к данному формату.
* ```protected requireFormat(AbstractFormat $format): ?mixed``` - добавляет формат, который необходим для работы текущего формата
* ```delete(string $name, bool $silent): void``` - удалить файл, который относится к данному формату
* ```duplicate(string $path, string $destPath): void``` -  клонировать файл, который относится к данному формату
* ```abstract createEditor(string $path, array $options): ide\editors\AbstractEditor``` - создать редактор для файла, который относится к данному формату
* ```createBlank(ide\project\Project $project, $file, array $options): ProjectFile``` - создать пустой файл, который будет относиться к данному формату.
* ```availableCreateDialog(): bool``` - данный метод должен возвращать true, если для создания файла для данного формата, необходимо показать дополнительный диалог с настройками.
* ```showCreateDialog(): ?string``` - показать диалог с необходимыми настройками.
* ```isValid($file): bool``` - метод должен возвращать true, если данный формат способен обработать **$file**.
* ```createBlankCommand(): ?AbstractCommand``` - ???
* ```createCreator(): null``` - ???
* ```register($any): mixed``` - ???

Давайте разберёмся подробнее с этими методами.

```getIcon()``` и ```getTitle()``` вызываются при необходимости отобразить информация о файле, который принадлежит данному формату. Хорошим(и возможно единственным) примером, может послужить дерево проекта.

![FileTree](https://raw.githubusercontent.com/broelik/dn_inside/master/images/tree_format_example.png)

```delete()``` вызывается при удалении файла(например, всё из того же дерева проекта).

```duplicate()``` позволяет клонировать файл. Например, данный метод используется для клонирования форм и скриптов в GUI проекте.

```createBlank()```  вызывается для создания пустого файла, для данного формата. WizardFramework оказался единственным местом, в котором используется данный метод. По сути - это некий шаблонизатор(наверное).

```createBlankCommand()``` использование данного метода, также как метода ```createBlank```, замечено только в WizardFramework, так что описание отсутствует. 

```createEditor()``` - вызывается для создания редактора. О редакторах позже. 

```availableCreateDialog()``` и ```showCreateDialog()``` служат для дополнительного ввода данных при создании файла для формата. Например, для создания модуля или формы.